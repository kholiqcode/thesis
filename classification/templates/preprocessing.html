{% extends "app.html" %} {% load static %} {% block content %}
<div class="content__header content__boxed overlapping">
  <div class="content__wrap">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item active" aria-current="page">PreProcessing</li>
      </ol>
    </nav>
    <!-- END : Breadcrumb -->

    <h1 class="page-title mb-0 mt-2">PreProcessing</h1>

    {% comment %} <p class="lead">Interactive Tables and Data Grids for JavaScript.</p> {% endcomment %}
  </div>
</div>

<div class="content__boxed">
  <div class="content__wrap">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title">Filter Data</h5>

        <!-- Toolbar -->
        <div class="row">
            <div class="col-sm-12">
                        <div class="form-group">
                            <label for="sentiment">Sentiment</label>
                            <select
                            id="sentiment"
                            name="sentiment"
                            class="select2 form-control"
                            >
                            <option selected disabled>Pilih Sentiment</option>
                            <option value="semua">Semua</option>
                            <option value="positive">Positif</option>
                            <option value="negative">Negatif</option>
                            <option value="neutral">Netral</option>
                            </select>
                        </div>
                    </div>
          </div>
          <!-- END : Toolbar -->
         <div class="card-body">
           <!-- Default Accordion -->
                            <div class="accordion" id="_dm-gapAccordion">
                                <div class="accordion-item">
                                    <div class="accordion-header" id="_dm-gapAccHeadingOne">
                                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#_dm-gapAccCollapseOne" aria-expanded="true" aria-controls="_dm-gapAccCollapseOne">
                                            Data Asli
                                        </button>
                                    </div>
                                    <div id="_dm-gapAccCollapseOne" class="accordion-collapse collapse show" aria-labelledby="_dm-gapAccHeadingOne" data-bs-parent="#_dm-defaultAccordion">
                                        <div class="accordion-body">
                                            <div class="table-responsive">
                <table class="table table-striped text-center">
                    <thead>
                        <tr>
                            <th class="text-center" width="5%">ID</th>
                            <th>Tweet</th>
                            <th>Sentimen</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i,v in dataset.iterrows %}
                        <tr>
                            <td><a class="btn-link" href="#"> {{forloop.counter }}</a></td>
                            <td width="85%">{{v.text}}</td>
                            <td class="fs-5">
                                <div class="badge {% if v.sentiment == 'positive' %} bg-success {% elif v.sentiment == 'negative' %} bg-danger {% else %} bg-info {% endif%}">{{v.sentiment}}</div>
                            </td>
                        </tr>
                        {% endfor %}
                        
                  </tbody>
              </table>
          </div>
      </div>
  </div
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <div class="accordion-header" id="_dm-gapAccHeadingTwo">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#_dm-gapAccCollapseTwo" aria-expanded="false" aria-controls="_dm-gapAccCollapseTwo">
                                            Cleaning
                                        </button>
                                    </div>
                                    <div id="_dm-gapAccCollapseTwo" class="accordion-collapse collapse" aria-labelledby="_dm-gapAccHeadingTwo" data-bs-parent="#_dm-defaultAccordion">
                                        <div class="accordion-body">
                                        <div class="table-responsive">
                <table class="table table-striped text-center">
                    <thead>
                        <tr>
                            <th class="text-center" width="5%">ID</th>
                            <th>Tweet</th>
                            <th>Sentimen</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i,v in dataset.iterrows %}
                        <tr>
                            <td><a class="btn-link" href="#"> {{forloop.counter }}</a></td>
                            <td width="85%">{{v.cleaning}}</td>
                           <td class="fs-5">
                                <div class="badge {% if v.sentiment == 'positive' %} bg-success {% elif v.sentiment == 'negative' %} bg-danger {% else %} bg-info {% endif%}">{{v.sentiment}}</div>
                            </td>
                        </tr>
                        {% endfor %}
                        
                  </tbody>
              </table>
          </div>  
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <div class="accordion-header" id="_dm-gapAccHeadingThree">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#_dm-gapAccCollapseThree" aria-expanded="false" aria-controls="_dm-gapAccCollapseThree">
                                            Casefolding
                                        </button>
                                    </div>
                                    <div id="_dm-gapAccCollapseThree" class="accordion-collapse collapse" aria-labelledby="_dm-gapAccHeadingThree" data-bs-parent="#_dm-defaultAccordion">
                                        <div class="accordion-body">
                                            <div class="table-responsive">
                <table class="table table-striped text-center">
                    <thead>
                        <tr>
                            <th class="text-center" width="5%">ID</th>
                            <th>Tweet</th>
                            <th>Sentimen</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i,v in dataset.iterrows %}
                        <tr>
                            <td><a class="btn-link" href="#"> {{forloop.counter }}</a></td>
                            <td width="85%">{{v.casefolding}}</td>
                            <td class="fs-5">
                                <div class="badge {% if v.sentiment == 'positive' %} bg-success {% elif v.sentiment == 'negative' %} bg-danger {% else %} bg-info {% endif%}">{{v.sentiment}}</div>
                            </td>
                        </tr>
                        {% endfor %}
                        
                  </tbody>
              </table>
          </div> </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <div class="accordion-header" id="_dm-gapAccHeadingFour">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#_dm-gapAccCollapseFour" aria-expanded="false" aria-controls="_dm-gapAccCollapseFour">
                                            Tokenizing
                                        </button>
                                    </div>
                                    <div id="_dm-gapAccCollapseFour" class="accordion-collapse collapse" aria-labelledby="_dm-gapAccHeadingFour" data-bs-parent="#_dm-defaultAccordion">
                                        <div class="accordion-body">
                                           <div class="table-responsive">
                <table class="table table-striped text-center">
                    <thead>
                        <tr>
                            <th class="text-center" width="5%">ID</th>
                            <th>Tweet</th>
                            <th>Sentimen</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i,v in dataset.iterrows %}
                        <tr>
                            <td><a class="btn-link" href="#"> {{forloop.counter }}</a></td>
                            <td width="85%">{{v.tokenizing}}</td>
                            <td class="fs-5">
                                <div class="badge {% if v.sentiment == 'positive' %} bg-success {% elif v.sentiment == 'negative' %} bg-danger {% else %} bg-info {% endif%}">{{v.sentiment}}</div>
                            </td>
                        </tr>
                        {% endfor %}
                        
                  </tbody>
              </table>
          </div></div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <div class="accordion-header" id="_dm-gapAccHeadingFive">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#_dm-gapAccCollapseFive" aria-expanded="false" aria-controls="_dm-gapAccCollapseFive">
                                            Normalisasi
                                        </button>
                                    </div>
                                    <div id="_dm-gapAccCollapseFive" class="accordion-collapse collapse" aria-labelledby="_dm-gapAccHeadingFive" data-bs-parent="#_dm-defaultAccordion">
                                        <div class="accordion-body">
                                           <div class="table-responsive">
                <table class="table table-striped text-center">
                    <thead>
                        <tr>
                            <th class="text-center" width="5%">ID</th>
                            <th>Tweet</th>
                            <th>Sentimen</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i,v in dataset.iterrows %}
                        <tr>
                            <td><a class="btn-link" href="#"> {{forloop.counter }}</a></td>
                            <td width="85%">{{v.normalisasi}}</td>
                            <td class="fs-5">
                                <div class="badge {% if v.sentiment == 'positive' %} bg-success {% elif v.sentiment == 'negative' %} bg-danger {% else %} bg-info {% endif%}">{{v.sentiment}}</div>
                            </td>
                        </tr>
                        {% endfor %}
                        
                  </tbody>
              </table>
          </div> </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <div class="accordion-header" id="_dm-gapAccHeadingSix">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#_dm-gapAccCollapseSix" aria-expanded="false" aria-controls="_dm-gapAccCollapseSix">
                                            Stopword
                                        </button>
                                    </div>
                                    <div id="_dm-gapAccCollapseSix" class="accordion-collapse collapse" aria-labelledby="_dm-gapAccHeadingSix" data-bs-parent="#_dm-defaultAccordion">
                                        <div class="accordion-body">
                                           <div class="table-responsive">
                <table class="table table-striped text-center">
                    <thead>
                        <tr>
                            <th class="text-center" width="5%">ID</th>
                            <th>Tweet</th>
                            <th>Sentimen</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i,v in dataset.iterrows %}
                        <tr>
                            <td><a class="btn-link" href="#"> {{forloop.counter }}</a></td>
                            <td width="85%">{{v.stopword}}</td>
                            <td class="fs-5">
                                <div class="badge {% if v.sentiment == 'positive' %} bg-success {% elif v.sentiment == 'negative' %} bg-danger {% else %} bg-info {% endif%}">{{v.sentiment}}</div>
                            </td>
                        </tr>
                        {% endfor %}
                        
                  </tbody>
              </table>
          </div> </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <div class="accordion-header" id="_dm-gapAccHeadingSeven">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#_dm-gapAccCollapseSeven" aria-expanded="false" aria-controls="_dm-gapAccCollapseSeven">
                                            Steeming
                                        </button>
                                    </div>
                                    <div id="_dm-gapAccCollapseSeven" class="accordion-collapse collapse" aria-labelledby="_dm-gapAccHeadingSeven" data-bs-parent="#_dm-defaultAccordion">
                                        <div class="accordion-body">
                                           <div class="table-responsive">
                <table class="table table-striped text-center">
                    <thead>
                        <tr>
                            <th class="text-center" width="5%">ID</th>
                            <th>Tweet</th>
                            <th>Sentimen</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i,v in dataset.iterrows %}
                        <tr>
                            <td><a class="btn-link" href="#"> {{forloop.counter }}</a></td>
                            <td width="85%">{{v.steeming}}</td>
                            <td class="fs-5">
                                <div class="badge {% if v.sentiment == 'positive' %} bg-success {% elif v.sentiment == 'negative' %} bg-danger {% else %} bg-info {% endif%}">{{v.sentiment}}</div>
                            </td>
                        </tr>
                        {% endfor %}
                        
                  </tbody>
              </table>
          </div> </div>
                                    </div>
                                </div>
                            </div>
                            <!-- END : Default Accordion -->
                       <nav class="text-align-center mt-5" aria-label="Table navigation">
              <ul class="pagination justify-content-center">
                  <li class="page-item {% if has_previous is False %}disabled{% endif %}">
                      <a href="?page={{previous_page}}{% if request.GET.sentiment %}&sentiment={{ request.GET.sentiment }}{% endif %}" class="page-link">Previous</a>
                    </li>
                    {% if current_page != 1 %}
                    <li class="page-item"><a class="page-link" href="?page=1{% if request.GET.sentiment %}&sentiment={{ request.GET.sentiment }}{% endif %}">1</a></li>
                    {% endif %}
                    <li class="page-item disabled"><a class="page-link" href="#">...</a></li>
                {% if current_page >= page_count %}
                  <li class="page-item"><a class="page-link" href="?page={{current_page|add:-1}}{% if request.GET.sentiment %}&sentiment={{ request.GET.sentiment }}{% endif %}">{{current_page|add:-1}}</a></li>
                  <li class="page-item"><a class="page-link" href="?page={{current_page|add:-2}}{% if request.GET.sentiment %}&sentiment={{ request.GET.sentiment }}{% endif %}">{{current_page|add:-2}}</a></li>
                  {% endif %}
                  <li class="page-item active" aria-current="page">
                      <span class="page-link">{{current_page}}</span>
                  </li>
                  {% if current_page <= page_count %}
                  <li class="page-item"><a class="page-link" href="?page={{current_page|add:1}}{% if request.GET.sentiment %}&sentiment={{ request.GET.sentiment }}{% endif %}">{{current_page|add:1}}</a></li>
                  <li class="page-item"><a class="page-link" href="?page={{current_page|add:2}}{% if request.GET.sentiment %}&sentiment={{ request.GET.sentiment }}{% endif %}">{{current_page|add:2}}</a></li>
                  {% endif %}
                  <li class="page-item disabled"><a class="page-link" href="#">...</a></li>
                  <li class="page-item"><a class="page-link" href="?page={{page_count}}{% if request.GET.sentiment %}&sentiment={{ request.GET.sentiment }}{% endif %}">{{page_count}}</a></li>
                  <li class="page-item">
                      <a class="page-link" href="?page={{next_page}}{% if request.GET.sentiment %}&sentiment={{ request.GET.sentiment }}{% endif %}">Next</a>
                  </li>
              </ul>
          </nav>
      </div>
    </div>
  </div>

  {% endblock content %} 
  {% block style %}
  <link
    href="{% static 'assets/css/plugins/dataTables.bootstrap.css' %}"
    rel="stylesheet"
  ></link>
  <link
    href="{% static 'assets/css/plugins/responsive.dataTables.min.css' %}"
    rel="stylesheet"
  ></link>
  <link
    href="{% static 'assets/css/plugins/select2.min.css' %}"
    rel="stylesheet"
  ></link>
  {% endblock style %}
  {% block script %}
  <script
    src="{% static 'assets/js/plugins/jquery.min.js' %}"
    
  ></script>
  <script
    src="{% static 'assets/js/plugins/jquery.dataTables.js' %}"
    
  ></script>
  <script
    src="{% static 'assets/js/plugins/select2.min.js' %}"
    
  ></script>
  <script
    src="{% static 'assets/js/plugins/dataTables.bootstrap.js' %}"
    
  ></script>
  <script
    src="{% static 'assets/js/plugins/dataTables.responsive.min.js' %}"
    
  ></script>
  <script>
        $(".select2").select2({
            placeholder: "Pilih...",
        });

        $('#kecamatan').change(function() {
            var kecamatan = $(this).children('option:selected').val();
            var url = $('#kelurahan').data('url');
            $.ajax({
                url,
                type: "GET",
                data: {
                    kecamatan
                },
                success: function(response) {
                    $('#kelurahan').empty();
                    response?.data?.forEach(function(item, index) {
                        $('#kelurahan').append(
                            `<option value="${item?.id}">${item?.nama}</option>`)
                    })
                },
            })
        });
        $.fn.DataTable.ext.pager.numbers_length = 5;

        // Basic Data Tables with responsive plugin
        // -----------------------------------------------------------------
        var table = $('#datatables').DataTable({
            "responsive": true,
            "language": {
                "paginate": {
                    "previous": '<i class="demo-psi-arrow-left"></i>',
                    "next": '<i class="demo-psi-arrow-right"></i>'
                }
            },
            pageLength: 10,
            scrollX: false,
            scrollY: true,
            processing: true,
            serverSide: true,
            ajax: {
                url: $('#datatables').data('url'),
                data: function(d) {
                    let kelurahan = $('#inputkelurahan').val();
                    if(kelurahan !== undefined && kelurahan !== ''){
                        d.kelurahan = $('#inputkelurahan').val();
                    }
                }
            },
            columns: [{
                    data: 'DT_RowIndex',
                    name: 'DT_RowIndex',
                    orderable: false,
                    searchable: false
                },
                {
                    data: 'nama',
                    name: 'nama'
                },
                {
                    data: 'kelurahan',
                    name: 'kelurahan'
                },
                {
                    data: 'kecamatan',
                    name: 'kecamatan'
                },
                {
                    data: 'jenis_kelamin',
                    name: 'jenis_kelamin'
                },
                {
                    data: 'tempat_lahir',
                    name: 'tempat_lahir'
                },
                {
                    data: 'action',
                    name: 'action'
                },
            ],
        });

        $('#kelurahan').change(function() {
            $('#inputkelurahan').val($(this).val());
            table.draw();
        });

        $('#sentiment').change(function() {
          const urlParams = new URLSearchParams(window.location.search);

          if($(this).val() == 'semua'){
            urlParams.delete('sentiment')
            window.location.search = urlParams;
            return
          }
          
          urlParams.set('sentiment', $(this).val());
          urlParams.delete('page')

          window.location.search = urlParams;
          {% comment %} window.location.replace(window.location+"?sentiment="+$(this).val()); {% endcomment %}
        });

        $(document).ready(function() {
            let filterParams = new URLSearchParams(window.location.search)
            if (filterParams.has('kelurahan')) {
                $('#inputkelurahan').val(filterParams.get('kelurahan'));
                table.draw();
            }
        });
    </script>
  {% endblock script %}
</div>
